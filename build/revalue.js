/*!
Copyright (c) 2016 guitarino
MIT License
*/var revalue=function(){"use strict";function t(e,t){for(var n=0;n<e.length;n++){var r=t(e[n]);if(r===!1)break}}function n(e,t){var n=e.indexOf(t);~n?e.splice(n,1):console.warn("The item",t,"does not exist in array",e)}function r(e){return typeof e=="object"&&e!==null?!0:!1}function i(e){if(typeof e._fun!="function")return e._value;var n=[],r=[];return t(e._dependencies,function(e){n.push(e._value),r.push("_old_value"in e?e._old_value:e._value)}),e._fun.apply(e,n.concat(r))}function s(e){var n=!1;return t(e._dependencies,function(e){if("_old_value"in e)return n=!0,!1}),n}function o(e){e._old_value=null,delete e._old_value,t(e._dependants,function(e){"_old_value"in e&&(e._old_value=null,delete e._old_value)})}function u(e){t(e._dependants,function(e){if(e._fun&&s(e)){var t=i(e);t!==e._value&&(e._old_value=e._value,e._value=t)}}),o(e)}var e=Array.isArray?Array.isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},a=function(e){this._dependencies=[],this._dependants=[]};a.prototype.of=function(e){if(e!==this._dependencies){var r=this;t(this._dependencies,function s(e){n(e._dependants,r),t(e._dependencies,s)}),this._dependencies=e,t(this._dependencies,function o(e){~e._dependants.indexOf(r)||(e._dependants.push(r),t(e._dependencies,o))}),this.set(i(this))}return this},a.prototype.is=function(e){return this._fun!==e&&(this._fun=e,this.set(i(this))),this},a.prototype.set=function(e){return this._value!==e&&(this._old_value=this._value,this._value=e,u(this)),this},a.prototype.get=function(){return this._value};var f=function(){var t,n;arguments.length<=1?(n=arguments[0],t={}):arguments.length>1&&(t=arguments[0],n=arguments[1]);if(typeof n=="function"){var i=n(f);if(r(i))for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])}else if(r(n))for(var s in n){var o=n[s];if(r(o)&&"is"in o&&typeof o.is=="function"){var u=e(o.dependencies)?o.dependencies:[];t[s]=f.fun.apply(null,u.map(function(e){return t[e]})).set(o.value).is(o.is)}else t[s]=f.var(o)}return t};return f.var=function(e){var t=new a;return t.set(e),t},f.fun=function(){var e=Array.prototype.slice.call(arguments,0),t=new a;return t.of(e),t},f.isVar=function(e){return e instanceof a&&!("_fun"in e)},f.isFun=function(e){return e instanceof a&&"_fun"in e},f}();(function(e){(!e||!e.window)&&module&&module.exports&&(module.exports=revalue)})(this);